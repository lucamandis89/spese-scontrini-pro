<!DOCTYPE html>

<html lang="it">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1,maximum-scale=1" name="viewport"/>
<meta content="#0b0f17" name="theme-color"/>
<meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate, max-age=0">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">
<title>Scontrini Facili Pro</title>
<link href="./manifest.webmanifest?v=37.2" rel="manifest"/>
<link href="./assets/logo.svg" rel="icon" type="image/svg+xml"/>
<link href="./style.css?v=37.2" rel="stylesheet"/>
<script defer="" src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
<script defer="" src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>

<script defer src="https://cdn.jsdelivr.net/npm/pdfjs-dist@3.11.174/build/pdf.min.js"></script>
<script defer src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
<script defer src="./app.js?v=37.2"></script>

</head>
<body>
<div class="bg"></div>
<div class="wrap">
<header class="topbar">
<div class="brand">
<img alt="Logo" class="logo" src="./assets/logo.svg"/>
<div class="bt">
<div class="t">Spese &amp; Scontrini <span class="proBadge">PRO</span></div>
<div class="s" id="subtitle">Home â€¢ Spese</div>
</div>
</div>
<div class="status">
<div class="pill" id="pillPro">Stato: <b>PRO</b></div>
</div>
</header>

<nav class="tabs">
<button class="tab active" data-page="home" id="tabHome" type="button">Home</button>
<button class="tab" data-page="archive" id="tabArchive" type="button">Archivio</button>
<button class="tab" data-page="report" id="tabReport" type="button">Report</button>
<button class="tab" data-page="settings" id="tabSettings" type="button">Impostazioni</button>
</nav>

<main class="main">
<!-- HOME -->
<section class="page active" id="pageHome">
<div class="card">
<div class="cardTop">
<div class="miniTitle">Questo mese</div>
<div class="miniRight">
<select class="sel" id="fMonth"></select>
</div>
</div>
<div class="big" id="sumMonth">â‚¬ 0,00</div>
<div class="muted" id="countMonth">0 spese</div>
<div class="divider"></div>
<div class="row">
<button class="btn primary" id="btnAdd" type="button">â• Aggiungi</button>
<button class="btn" id="btnBudget" type="button">ğŸ¯ Budget</button>
<button class="btn" id="btnExportCsv" type="button">â¬‡ï¸ CSV</button>
</div>
</div>

<div class="card">
<div class="miniTitle">Ultime spese</div>
<div class="list" id="listHome"></div>
</div>
</section>

<!-- ARCHIVIO -->
<section class="page" id="pageArchive">
<div class="card">
<div class="cardTop">
<div class="miniTitle">Filtra</div>
</div>
<div class="two">
<div>
<div class="lbl">Mese</div>
<select class="sel" id="aMonth"></select>
</div>
<div>
<div class="lbl">Categoria</div>
<select class="sel" id="aCat"></select>
</div>
</div>
<div class="two" style="margin-top:10px">
<div>
<div class="lbl">Da</div>
<input class="input" id="aFrom" type="date"/>
</div>
<div>
<div class="lbl">A</div>
<input class="input" id="aTo" type="date"/>
</div>
</div>
<div class="row" style="margin-top:10px">
<button class="btn primary" id="btnApplyFilter" type="button">Applica</button>
<button class="btn" id="btnClearFilter" type="button">Reset</button>
</div>
</div>

<div class="card">
<div class="miniTitle">Risultati</div>
<div class="list" id="listArchive"></div>
</div>
</section>

<!-- REPORT -->
<section class="page" id="pageReport">
<div class="card">
<div class="miniTitle">Tipo report</div>
<select class="sel" id="rMode">
<option value="month">Report Mensile</option>
<option value="caf">Report CAF / 730 (solo detraibili)</option>
</select>

<div class="two" style="margin-top:10px">
<div>
<div class="lbl">Mese</div>
<select class="sel" id="rMonth"></select>
</div>
<div>
<div class="lbl">Opzioni analisi</div>
<label class="switch">
<input id="anaOnlyCaf" type="checkbox"/>
<span class="slider"></span>
<span class="switchText">Solo detraibili</span>
</label>
</div>
</div>

<div class="row" style="margin-top:12px">
<button class="btn primary" id="btnMakePdf" type="button">ğŸ“„ Genera PDF</button>
<button class="btn" id="btnSendAccountant" type="button">ğŸ“¤ Invia 730 (commercialista)</button>
<button class="btn" id="btnBackup" type="button">â¬‡ï¸ Esporta backup</button>
<label class="btn" style="cursor:pointer">
              â¬†ï¸ Importa backup
              <input accept="application/json" id="inRestore" style="display:none" type="file"/>
</label>
</div>
<div class="divider"></div>

<!-- ANALISI / GRAFICO -->
<div class="anaCard">
<div class="anaTop">
<div>
<div class="miniTitle" style="margin:0">Analisi categorie</div>
<div class="muted">Bar chart + Top categorie</div>
</div>
</div>
<div class="anaBody">
<canvas height="220" id="anaChart"></canvas>
<div class="anaList" id="anaList"></div>
</div>
</div>
</div>
</section>

<!-- SETTINGS -->
<section class="page" id="pageSettings">
<div class="card">
<div class="miniTitle">OCR</div>
<div class="lbl">ModalitÃ  OCR</div>
<select class="sel" id="ocrMode">
<option value="auto">Auto (offline â†’ online)</option>
<option value="offline">Offline (Tesseract)</option>
<option value="online">Online (OCR.Space)</option>
</select>

<div class="lbl" style="margin-top:10px">Endpoint</div>
<input class="input" id="ocrEndpoint" placeholder="https://api.ocr.space/parse/image" type="text"/>

<div class="lbl" style="margin-top:10px">API Key OCR.Space</div>
<input class="input" id="ocrKey" placeholder="es. helloworld" type="password"/>

<div class="row" style="margin-top:12px">
<button class="btn" id="btnTestOcrKey" type="button">Test API Key</button>
</div>

<div class="divider"></div>

<div class="miniTitle">Auto-salva dopo OCR</div>
<label class="switch">
<input id="ocrAutoSave" type="checkbox"/>
<span class="slider"></span>
<span class="switchText">Auto-salva dopo OCR</span>
</label>
<div class="hint muted">Se ON, quando OCR trova importo+data salva automaticamente la spesa.</div>
</div>

<div class="card">
<div class="miniTitle">Privacy</div>
<label class="switch">
<input id="pinEnable" type="checkbox"/>
<span class="slider"></span>
<span class="switchText">Abilita PIN</span>
</label>
<div class="row" style="margin-top:12px">
<button class="btn" id="btnSetPin" type="button">Imposta / Cambia PIN</button>
<button class="btn" id="btnLockNow" type="button">Blocca ora</button>
<button class="btn bad" id="btnResetPin" type="button">Reset PIN</button>
</div>
</div>

<div class="card">
<div class="miniTitle">Dati</div>
<div class="row">
<button class="btn bad" id="btnWipeAll" type="button">ğŸ—‘ï¸ Cancella tutto</button>
</div>
<div class="hint muted">Attenzione: cancella tutte le spese salvate sul dispositivo.</div>
</div>
</section>

</main>

<!-- MODAL ADD -->
<div aria-hidden="true" class="modal" id="modalAdd">
<div class="box">
<div class="mh">
<h3 id="addTitle">â• Aggiungi spesa</h3>
<button class="btn small" id="addClose" type="button">âœ–</button>
</div>
<div class="mb">
<div class="two">
<div>
<div class="lbl">Importo (â‚¬)</div>
<input class="input" id="inAmount" inputmode="decimal" placeholder="0,00" type="text"/>
</div>
<div>
<div class="lbl">Data</div>
<input class="input" id="inDate" type="date"/>
</div>
</div>

<div class="lbl" style="margin-top:10px">Categoria</div>
<select class="sel" id="inCategory"></select>

<div class="lbl" style="margin-top:10px">Descrizione (facoltativa)</div>
<input class="input" id="inNote" placeholder="Es. spesa farmacia, ticket..." type="text"/>

<div class="divider"></div>

<div class="miniTitle">Scontrino (opzionale)</div>
<div class="row" style="margin-top:10px">
<button class="btn" id="btnReceiptCam" type="button">ğŸ“· Foto scontrino</button>
<button class="btn" id="btnReceiptGallery" type="button">ğŸ–¼ï¸ Allega scontrino</button>
<button class="btn" id="btnReceiptPdf" type="button">ğŸ“„ Importa PDF</button>
</div>
<input accept="image/*" capture="environment" hidden="" id="inPhotoCam" type="file"/>
<input accept="image/*" hidden="" id="inPhoto" type="file"/>
<input accept="application/pdf" hidden="" id="inPdf" type="file"/>
<img id="receiptPreview" class="receiptPreview" alt="Anteprima scontrino" style="display:none; max-width:100%; border-radius:12px; margin-top:10px;"/>
<div class="hint muted" style="margin-top:6px">Se possibile, lâ€™app prova a leggere importo e data automaticamente (OCR).</div>
<div class="row" style="margin-top:10px">
<button class="btn" id="btnOpenScanner" type="button">ğŸ“„ OCR (offline)</button>
<button class="btn" id="btnEnhancePhoto" type="button">ğŸ›ï¸ Migliora foto</button>
<button class="btn small bad" id="removePhoto" type="button">ğŸ—‘ï¸ Rimuovi foto</button>
</div>

<div class="divider"></div>

<div class="row">
<button class="btn primary" id="btnSave" type="button">ğŸ’¾ Salva</button>
<button class="btn" id="btnCancel" type="button">Annulla</button>
</div>
</div>
</div>
</div>

<!-- MODAL DETAILS -->
<div aria-hidden="true" class="modal" id="modalDetails">
<div class="box">
<div class="mh">
<h3>Dettagli</h3>
<button class="btn small" id="detClose" type="button">âœ–</button>
</div>
<div class="mb" id="detailsBody"></div>
</div>
</div>

<!-- MODAL BUDGET -->
<div aria-hidden="true" class="modal" id="modalBudget">
<div class="box">
<div class="mh">
<h3>ğŸ¯ Budget</h3>
<button class="btn small" id="budClose" type="button">âœ–</button>
</div>
<div class="mb">
<div class="lbl">Budget mensile (â‚¬)</div>
<input class="input" id="budValue" inputmode="decimal" placeholder="0,00" type="text"/>
<div class="row" style="margin-top:12px">
<button class="btn primary" id="budSave" type="button">Salva</button>
</div>
</div>
</div>
</div>

<!-- MODAL SCANNER -->
<div aria-hidden="true" class="modal" id="modalScanner">
<div class="box">
<div class="mh">
<h3>ğŸ›ï¸ Scanner</h3>
<button class="btn small" id="scanClose" type="button">âœ–</button>
</div>
<div class="mb">
<canvas id="scanCanvas" style="width:100%; border-radius:12px"></canvas>
<div class="row" style="margin-top:10px">
<button class="btn" id="scanRotate" type="button">â¤¾ Ruota</button>
<button class="btn" id="scanContrast" type="button">Contrasto</button>
<button class="btn" id="scanBright" type="button">LuminositÃ </button>
<button class="btn primary" id="scanApply" type="button">Applica</button>
</div>
</div>
</div>
</div>

<!-- CAMERA MODAL -->
<div aria-hidden="true" class="modal" id="camModal">
<div class="box">
<div class="mh">
<h3>ğŸ“· Camera</h3>
<button class="btn small" id="camClose" type="button">âœ–</button>
</div>
<div class="mb">
<div class="hint muted">Se il tuo telefono non apre la camera, usa â€œAllega scontrinoâ€.</div>
</div>
</div>
</div>

<!-- PRO MODAL -->
<div aria-hidden="true" class="modal" id="modalPro">
<div class="box">
<div class="mh">
<h3>PRO</h3>
<button class="btn small" id="proClose" type="button">âœ–</button>
</div>
<div class="mb" id="proBody"></div>
</div>
</div>

<!-- TOAST -->
<div id="toast"></div>

</div>

<!-- MODAL COMMERCIALISTA (730) -->
<div aria-hidden="true" class="modal" id="modalAccountant">
  <div class="box">
    <div class="mh">
      <h3>ğŸ“¤ Invia al commercialista (730)</h3>
      <button class="btn small" id="accClose" type="button">âœ–</button>
    </div>
    <div class="mb">
      <div class="hint muted">Invia automaticamente solo i file utili al 730: CSV + PDF delle spese detraibili. (Niente foto)</div>
      <div class="two" style="margin-top:12px">
        <div>
          <div class="lbl">Dal</div>
          <input class="input" id="accFrom" type="date"/>
        </div>
        <div>
          <div class="lbl">Al</div>
          <input class="input" id="accTo" type="date"/>
        </div>
      </div>
      <div class="row" style="margin-top:12px">
        <button class="btn" id="accPresetThis" type="button">ğŸ“… Mese corrente</button>
        <button class="btn" id="accPresetPrev" type="button">â®ï¸ Mese scorso</button>
      </div>
      <div class="divider"></div>
      <div class="row">
        <button class="btn primary" id="accSend" type="button">ğŸ“¤ Crea pacchetto 730 e invia</button>
      </div>
    </div>
  </div>
</div>

</body>
</html>
